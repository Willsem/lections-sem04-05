# Машинно-зависимые языки программирования

**Алексеев Юрий Евтихович**

## Лекция 1

* Юров Ассемблер для ВУЗов
* Зубков СВ Ассемблер для DOS, Windows, Unix
* Калашников Ассемблер это просто
* Ирвин Язык ассемблера для процессоров Intel

### Регистры

**Регистр** - быстродействующая ячейка памяти, содержащий один байт.

#### Регистры общего назначения 

| 15| 7| 0|
|---|---|---|
| AX| AH| AL|
| BX| BH| BL|
| CX| CH| CL|
| DX| DH| DL|

#### Регистры смещения

| 15 0|
|---|
| SI|
| DI|
| BP|

| 15 0| |
|---|---|
| SP|указатель стека|
| IP|указатель команды|
| Флаги|Регистр флагов|

#### Сегментные регистры

| 15 0|
|---|
| CS|
| DS|
| SS|
| ES|

CS:IP

#### Регистр флагов

|15|14|13|12|11|10|9|8|7|6|5|4|3|2|1|0|
|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|---|
|0|NT|IOPL|IOPL|OF|DF|IF|TF|SF|ZF|0|AF|0|PF|1|CF|

* CF - *Флаг переноса*
* PF - *Флаг чётности* 
* AF - *Флаг дополнительного переноса*
* ZF - *Флаг нуля*
* SF - *Флаг знака*
* TF - *Флаг трассировки*
* IF - *Флаг прерывания*

```nasm
INT 21h
```
	
* DF - *Флаг направления*
* OF - *Флаг переполнения*

#### Стек 

**Стек** - динамическая конструкция, которая работает по принципу первый вшел послений вышел. Расположен всегда в конце сегмента стека.

##### Сегмент стека

|||
|---|---|
|X|N <- SP - указатель стека|
||N - 1 - рост стека|
|||
|||
|||
|||
|||

```nasm
push X
	SP := SP - 2
	[SP] := X

pop Y
	Y := [SP]
	SP := SP + 2
```

Директива `END` говорит о том, что код закончился. Код может состоять из нескольких модулей, каждый из которых должен быть указан.

#### Возможные структуры сегмента кода

```nasm
	ИмяСегментаКода SEGMENT
	ASSUME ИмяСегментаКода : CS, ИмяСегментаСтека : DS, ...
		имя_p1 PROC [FAR или NEAR] ; FAR - дальняя точка доступа
			...
			CALL имя_pi
			...
			CALL имя_pj
			...
		имя_p1 ENDP
		
		имя_p2 PROC ...
			...
		имя_p2 ENDP
	ИмяСегментаКода END
MOD2
END имя_p1
```

#### Возможные начало и завершение процедур

`RET` - возврат управления

```nasm
имя_p1 PROC FAR
	PUSH DS                  ; Подготовка к выходу из программы
	MOV AX,0                 ; Подготовка к выходу из программы
	PUSH AX                  ; Подготовка к выходу из программы
	MOV AX,ИмяСегментаДанных ; Связывание сегмента данных
	MOV DS,AX                ; Связывание сегмента данных
	...
	RET                      ; Выход из программы
```

||<-- Наша программа|
|---|---|
|PSP||
|INT 20h||

$?+-/ и т.д.

Имена могут строиться из букв, цифр, подчерка, вопроса, доллара и собаки

#### Используются следующие термины

* Переменная - используется для сслыки на данные. После определения компилятор может извлечь следующие данные:
	* тип переменной
	* Сегмент, с которым связана переменная
	* Смещение в этом сегменте

#### Примеры определения переменных

||Тип |Сегмент |Смещение|
|---|---|---|---|
|`X DB ? `|`TYPE X `(рез=1)|`SEG X` (N§ начала сегмента, в котором определена X) |`OFFSET X`|
|`Y DW 10ABh`  |`TYPE Y` (рез=2)|`SEG Y` (N§ начала сегмента, в котором определена Y) |`OFFSET Y`|

#### Пример определения меток

**Символические имена** - имена, которые обрабатывает препроцессор

M:

K proc FAR||NEAR
